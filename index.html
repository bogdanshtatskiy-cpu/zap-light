<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì—Ä–∞—Ñ—ñ–∫ –í—ñ–¥–∫–ª—é—á–µ–Ω—å</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #212121;
            --tg-theme-text-color: #ffffff;
            --tg-theme-button-color: #3390ec;
            --tg-theme-button-text-color: #ffffff;
            --off-color: #ff4b4b; /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏–π */
            --on-color: #4bb34b;  /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è —Å–≤–µ—Ç–∞ */
        }
        
        body {
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        h2 { text-align: center; margin-bottom: 5px; }
        .subtitle { text-align: center; opacity: 0.7; font-size: 0.9em; margin-bottom: 20px; }

        select {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            font-size: 16px;
            margin-bottom: 20px;
            appearance: none;
            text-align: center;
        }

        /* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ */
        .timeline-container {
            display: flex;
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 10px;
            border: 1px solid #444;
        }

        .hour-block {
            flex: 1;
            height: 100%;
            background-color: var(--on-color); /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–≤–µ—Ç –µ—Å—Ç—å */
            position: relative;
        }

        .hour-block.off {
            background-color: var(--off-color);
        }

        /* –ü–æ–¥–ø–∏—Å–∏ –≤—Ä–µ–º–µ–Ω–∏ */
        .time-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            opacity: 0.6;
            margin-bottom: 30px;
        }

        .status-card {
            background: rgba(255,255,255, 0.1);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }
        .status-text { font-size: 1.2em; font-weight: bold; }
    </style>
</head>
<body>

    <h2 id="date-header">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</h2>
    <div class="subtitle" id="update-time"></div>

    <select id="queue-select">
        <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –≤–∞—à—É —á–µ—Ä–≥—É</option>
        <option value="1.1">–ß–µ—Ä–≥–∞ 1.1</option>
        <option value="1.2">–ß–µ—Ä–≥–∞ 1.2</option>
        <option value="2.1">–ß–µ—Ä–≥–∞ 2.1</option>
        <option value="2.2">–ß–µ—Ä–≥–∞ 2.2</option>
        <option value="3.1">–ß–µ—Ä–≥–∞ 3.1</option>
        <option value="3.2">–ß–µ—Ä–≥–∞ 3.2</option>
        <option value="4.1">–ß–µ—Ä–≥–∞ 4.1</option>
        <option value="4.2">–ß–µ—Ä–≥–∞ 4.2</option>
        <option value="5.1">–ß–µ—Ä–≥–∞ 5.1</option>
        <option value="5.2">–ß–µ—Ä–≥–∞ 5.2</option>
        <option value="6.1">–ß–µ—Ä–≥–∞ 6.1</option>
        <option value="6.2">–ß–µ—Ä–≥–∞ 6.2</option>
    </select>

    <div id="visual-schedule">
        </div>
    
    <div class="time-labels">
        <span>00</span><span>06</span><span>12</span><span>18</span><span>24</span>
    </div>

    <div class="status-card" id="current-status-card" style="display:none;">
        –°–µ–π—á–∞—Å: <span id="current-status-text" class="status-text">...</span>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // –ù–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON (–∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–ª Python)
        async function loadData() {
            try {
                // –í–ê–ñ–ù–û: –¢—É—Ç –±—É–¥–µ—Ç —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–≤–æ–π JSON –Ω–∞ GitHub Pages
                const response = await fetch('schedule.json'); 
                const data = await response.json();
                return data;
            } catch (e) {
                document.getElementById('date-header').innerText = "–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö";
                console.error(e);
            }
        }

        function drawSchedule(queueData) {
            const container = document.getElementById('visual-schedule');
            container.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º 48 –±–ª–æ–∫–æ–≤ (–ø–æ 30 –º–∏–Ω—É—Ç) –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
            const blocks = 48; 
            const timeline = document.createElement('div');
            timeline.className = 'timeline-container';

            // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω—è–µ–º –º–∞—Å—Å–∏–≤ "—Å–≤–µ—Ç–∞" (true = –µ—Å—Ç—å —Å–≤–µ—Ç)
            let scheduleMap = new Array(blocks).fill(true);

            if (queueData) {
                queueData.forEach(interval => {
                    const [startH, startM] = interval.start.split(':').map(Number);
                    const [endH, endM] = interval.end.split(':').map(Number);
                    
                    const startIndex = (startH * 2) + (startM === 30 ? 1 : 0);
                    let endIndex = (endH * 2) + (endM === 30 ? 1 : 0);
                    
                    if (endIndex === 0) endIndex = 48; // 24:00

                    for (let i = startIndex; i < endIndex; i++) {
                        if (i < 48) scheduleMap[i] = false; // –°–≤–µ—Ç–∞ –Ω–µ—Ç
                    }
                });
            }

            // –†–∏—Å—É–µ–º –±–ª–æ–∫–∏
            scheduleMap.forEach(hasLight => {
                const div = document.createElement('div');
                div.className = 'hour-block ' + (hasLight ? '' : 'off');
                timeline.appendChild(div);
            });

            container.appendChild(timeline);
            updateCurrentStatus(scheduleMap);
        }

        function updateCurrentStatus(scheduleMap) {
            const now = new Date();
            // –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –£–∫—Ä–∞–∏–Ω—ã (UTC+2 / UTC+3). –£–ø—Ä–æ—â–µ–Ω–Ω–æ –±–µ—Ä–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –≤ –ó–ü
            const currentBlockIndex = (now.getHours() * 2) + (now.getMinutes() >= 30 ? 1 : 0);
            
            const hasLight = scheduleMap[currentBlockIndex];
            const statusText = document.getElementById('current-status-text');
            const card = document.getElementById('current-status-card');
            
            card.style.display = 'block';
            if (hasLight) {
                statusText.innerText = "–°–í–Ü–¢–õ–û –Ñ üí°";
                statusText.style.color = "var(--on-color)";
            } else {
                statusText.innerText = "–í–Ü–î–ö–õ–Æ–ß–ï–ù–ù–Ø üïØÔ∏è";
                statusText.style.color = "var(--off-color)";
            }
        }

        // –õ–æ–≥–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        (async () => {
            const data = await loadData();
            if (!data) return;

            document.getElementById('date-header').innerText = `–ì–ü–í –Ω–∞ ${data.date}`;
            document.getElementById('update-time').innerText = `–û–Ω–æ–≤–ª–µ–Ω–æ: ${data.updated_at}`;

            const select = document.getElementById('queue-select');
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const savedQueue = localStorage.getItem('selectedQueue');
            if (savedQueue) {
                select.value = savedQueue;
                drawSchedule(data.queues[savedQueue]);
            }

            select.addEventListener('change', (e) => {
                const q = e.target.value;
                localStorage.setItem('selectedQueue', q); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä
                drawSchedule(data.queues[q]);
            });
        })();
    </script>
</body>
</html>