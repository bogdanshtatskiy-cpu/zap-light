<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ì–ü–í –ó–∞–ø–æ—Ä—ñ–∂–∂—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;600;700;900&family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    
    <script src="quotes.js"></script> 
    <script src="changelog.js"></script>
    <script src="weather_advice.js"></script>
    <script src="weather.js"></script>

    <style>
        /* --- –°–¢–ò–õ–ò –î–õ–Ø –ö–ù–û–ü–ö–ò –î–û–ù–ê–¢–ê --- */
        .donate-wrap {
            text-align: center;
            margin-bottom: 15px;
            margin-top: -10px;
            position: relative;
            z-index: 5;
        }
        .donate-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--glass-bg, rgba(255, 255, 255, 0.65));
            border: 1px solid var(--glass-border, rgba(255, 255, 255, 0.8));
            padding: 8px 20px;
            border-radius: 20px;
            text-decoration: none;
            color: var(--text, #1e3a8a);
            font-size: 14px;
            font-weight: 800;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .donate-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        body.dark-mode .donate-btn {
            background: rgba(30, 41, 59, 0.6);
            border-color: rgba(255, 255, 255, 0.1);
            color: #f1f5f9;
        }

        /* --- –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ü–ï–†–°–û–ù–ê–ñ–ê (POWER SPIRIT) --- */
        .bulb-icon-wrap {
            overflow: visible; 
            padding: 10px 0;
            height: auto;
            min-height: 260px; /* –ú–µ—Å—Ç–æ –¥–ª—è –ª–µ–≤–∏—Ç–∞—Ü–∏–∏ */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #power-spirit {
            width: 100%;
            max-width: 280px;
            height: auto;
            overflow: visible;
        }

        /* –ë–∞–∑–æ–≤—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        #body-shape, #sunglasses-group, #candle-group, #eyes-open, #eyes-sad, #shadow {
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* === –†–ï–ñ–ò–ú –°–í–ï–¢ –ï–°–¢–¨ (BOSS MODE) === */
        
        /* –¢–µ–ª–æ: –ñ–µ–ª—Ç–æ–µ, –∫—Ä—É–≥–ª–æ–µ, –ª–µ–≤–∏—Ç–∏—Ä—É–µ—Ç */
        .mode-on #body-shape {
            fill: url(#gradOn);
            transform: translateY(-20px); /* –ü–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö */
            filter: url(#glow);
        }
        
        /* –¢–µ–Ω—å: –£–º–µ–Ω—å—à–∞–µ—Ç—Å—è –∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω–µ–µ (—ç—Ñ—Ñ–µ–∫—Ç –ø–æ–ª–µ—Ç–∞) */
        .mode-on #shadow {
            opacity: 0.4;
            transform: scale(0.8) translateY(20px);
            fill: #ffc107;
        }

        /* –û—á–∫–∏: –ü–∞–¥–∞—é—Ç —Å–≤–µ—Ä—Ö—É –Ω–∞ –≥–ª–∞–∑–∞ */
        .mode-on #sunglasses-group {
            opacity: 1;
            transform: translateY(0);
        }
        /* –°–ø—Ä—è—Ç–∞–Ω–Ω—ã–µ –æ—á–∫–∏ (—É–ª–µ—Ç–∞—é—Ç –≤–≤–µ—Ä—Ö) */
        #sunglasses-group { 
            opacity: 0; 
            transform: translateY(-100px) rotate(-10deg); 
        }

        /* –°–≤–µ—á–∞: –ü—Ä—è—á–µ—Ç—Å—è –≤–Ω–∏–∑ */
        .mode-on #candle-group {
            opacity: 0;
            transform: translateY(50px) scale(0.5);
        }

        /* –ì–ª–∞–∑–∞: –û—Ç–∫—Ä—ã—Ç—ã–µ (—Å–ø—Ä—è—Ç–∞–Ω—ã –∑–∞ –æ—á–∫–∞–º–∏, –Ω–æ –∞–∫—Ç–∏–≤–Ω—ã) */
        .mode-on #eyes-open { opacity: 1; }
        .mode-on #eyes-sad { opacity: 0; }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ª–µ–≤–∏—Ç–∞—Ü–∏–∏ */
        .mode-on #main-group {
            animation: levitate 3s ease-in-out infinite;
        }


        /* === –†–ï–ñ–ò–ú –°–í–ï–¢–ê –ù–ï–¢ (MEDIEVAL MODE) === */

        /* –¢–µ–ª–æ: –°–∏–Ω–µ–µ, —Å–ø–ª—é—Å–Ω—É—Ç–æ–µ —Å–Ω–∏–∑—É (—Å–∏–¥–∏—Ç) */
        .mode-off #body-shape {
            fill: url(#gradOff);
            transform: translateY(15px) scaleY(0.95); /* –°–∞–¥–∏—Ç—Å—è –Ω–∞ –ø–æ–ª */
            filter: none;
        }

        /* –¢–µ–Ω—å: –¢–µ–º–Ω–∞—è –∏ —à–∏—Ä–æ–∫–∞—è */
        .mode-off #shadow {
            opacity: 0.6;
            transform: scale(1.1) translateY(15px);
            fill: #000;
        }

        /* –°–≤–µ—á–∞: –ü–æ—è–≤–ª—è–µ—Ç—Å—è */
        .mode-off #candle-group {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        /* –°–ø—Ä—è—Ç–∞–Ω–Ω–∞—è —Å–≤–µ—á–∞ */
        #candle-group { opacity: 0; }

        /* –ì–ª–∞–∑–∞: –ì—Ä—É—Å—Ç–Ω—ã–µ */
        .mode-off #eyes-open { opacity: 0; }
        .mode-off #eyes-sad { opacity: 1; }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –æ–≥–Ω—è */
        .mode-off #flame {
            animation: flicker 0.1s ease-in-out infinite alternate;
            transform-origin: center bottom;
        }
        
        /* –î—Ä–æ–∂–∞–Ω–∏–µ –æ—Ç —Ö–æ–ª–æ–¥–∞ */
        .mode-off #main-group {
            animation: coldShiver 2s ease-in-out infinite;
        }


        /* --- KEYFRAMES --- */
        @keyframes levitate {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes flicker {
            0% { transform: scale(1) rotate(-2deg); opacity: 0.9; }
            100% { transform: scale(1.1) rotate(2deg); opacity: 1; }
        }

        @keyframes coldShiver {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(1deg); }
            75% { transform: rotate(-1deg); }
        }

    </style>
</head>
<body>
    
    <div id="snow-container"></div>

    <div class="header">
        <div class="header-left">
            <div class="info-btn" onclick="openInfo()">i</div>
            <div class="weather-toggle-btn active" id="weather-toggle" onclick="toggleWeatherWidget()">
                üå§Ô∏è
            </div>
            <div class="tooltip" id="weather-tooltip">
                –ù–∞—Ç–∏—Å–Ω–∏ —Å—é–¥–∏, —â–æ–± —Å—Ö–æ–≤–∞—Ç–∏ –∞–±–æ –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≥–æ–¥—É üå§Ô∏è
                <button class="tooltip-btn" onclick="hideTooltip()">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
            </div>

            <div class="title-wrap" style="margin-left: 10px;">
                <div class="app-title" id="app-title">‚ö° –ì–ü–í</div>
                <div class="app-subtitle" id="city-label">–º. –ó–∞–ø–æ—Ä—ñ–∂–∂—è</div>
            </div>
        </div>
        <div class="lang-switch">
            <div class="lang-btn active" id="btn-uk" onclick="setLang('uk')">UA</div>
            <div class="lang-btn" id="btn-ru" onclick="setLang('ru')">RU</div>
        </div>
    </div>

    <div class="donate-wrap">
        <a href="https://mobile-app.pumb.ua/YCLM" target="_blank" class="donate-btn">
            ‚òï <span id="donate-text">–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏</span>
        </a>
    </div>

    <div id="weather-widget" class="weather-widget glass-panel">
        <div class="w-current">
            <div class="w-main">
                <span class="w-icon" id="w-icon"></span>
                <span class="w-temp" id="w-temp"></span>
            </div>
            <div class="w-info">
                <div class="w-desc" id="w-desc"></div>
                <div class="w-feel" id="w-feel"></div>
            </div>
        </div>
        <div class="w-hourly" id="w-hourly"></div>
        <div class="w-advice">
            <div class="w-advice-text" id="w-advice-text">...</div>
        </div>
    </div>

    <div class="date-wrap">
        <div class="date-container" id="dates"></div>
    </div>
    
    <div class="queue-grid" id="queues"></div>

    <div class="hero glass-panel" id="hero" style="display:none">
        
        <div class="bulb-icon-wrap" id="bulb-wrap">
            <svg id="power-spirit" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="gradOn" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#FFA000;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="gradOff" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#546E7A;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#263238;stop-opacity:1" />
                    </linearGradient>
                    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="10" result="coloredBlur"/>
                        <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                    </filter>
                </defs>

                <ellipse id="shadow" cx="200" cy="360" rx="80" ry="15" fill="#000" opacity="0.3" />

                <g id="main-group">
                    <circle id="body-shape" cx="200" cy="200" r="100" fill="url(#gradOff)" />

                    <g id="eyes-open" fill="#3E2723" opacity="0">
                        <circle cx="170" cy="190" r="12" />
                        <circle cx="230" cy="190" r="12" />
                        <path d="M180,220 Q200,235 220,220" fill="none" stroke="#3E2723" stroke-width="5" stroke-linecap="round" />
                    </g>

                    <g id="eyes-sad" fill="#CFD8DC" opacity="1">
                        <path d="M160,185 L180,205 M180,185 L160,205" stroke="#CFD8DC" stroke-width="5" stroke-linecap="round" />
                        <path d="M220,185 L240,205 M240,185 L220,205" stroke="#CFD8DC" stroke-width="5" stroke-linecap="round" />
                        <path d="M185,230 L215,230" stroke="#CFD8DC" stroke-width="5" stroke-linecap="round" />
                    </g>

                    <g id="sunglasses-group">
                        <path fill="#212121" d="M120,160 H280 V185 H260 V200 H230 V185 H170 V200 H140 V185 H120 Z" />
                        <rect x="130" y="165" width="30" height="5" fill="white" opacity="0.3"/>
                        <rect x="240" y="165" width="30" height="5" fill="white" opacity="0.3"/>
                    </g>

                    <g id="candle-group">
                        <circle cx="160" cy="260" r="15" fill="#37474F" />
                        <circle cx="240" cy="260" r="15" fill="#37474F" />
                        
                        <rect x="185" y="240" width="30" height="50" fill="#F5F5F5" rx="2" />
                        <path id="flame" d="M200,240 Q190,230 200,210 Q210,230 200,240 Z" fill="#FF5722">
                            <animate attributeName="fill" values="#FF5722;#FFC107;#FF5722" dur="0.5s" repeatCount="indefinite" />
                        </path>
                    </g>
                </g>
            </svg>
        </div>
        
        <div class="status-main" id="status">...</div>
        <div class="timer" id="timer">...</div>
        <div class="quote-box" id="quote"></div>
        <div class="last-update" id="updated"></div>
    </div>

    <div class="bar-wrap" id="bar-wrap" style="display:none">
        <div class="bar" id="visual"></div>
        <div class="marker" id="marker"></div>
        <div class="labels"><span>00</span><span>06</span><span>12</span><span>18</span><span>24</span></div>
    </div>

    <div class="stats" id="stats" style="display:none">
        <div class="stat-card">
            <span class="stat-label" id="lbl-on">–°–≤—ñ—Ç–ª–æ —î</span>
            <div class="stat-val on" id="val-on">-</div>
        </div>
        <div class="stat-card">
            <span class="stat-label" id="lbl-off">–°–≤—ñ—Ç–ª–∞ –Ω–µ–º–∞</span>
            <div class="stat-val off" id="val-off">-</div>
        </div>
    </div>

    <div class="list-card glass-panel" id="details-list" style="display:none"></div>
    <div class="loader" id="loader">...</div>

    <div id="info-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</div>
                <div class="close-btn" onclick="closeInfo()">√ó</div>
            </div>
            <div class="dev-info">
                <div style="font-size:13px; opacity:0.6; margin-bottom:2px; text-transform:uppercase; letter-spacing:1px;" id="dev-label">–†–æ–∑—Ä–æ–±–Ω–∏–∫</div>
                <div class="dev-nick">DesOope</div>
                <a href="https://t.me/desoope" target="_blank" class="dev-link">Telegram</a>
            </div>
            <div style="font-size:12px; font-weight:800; opacity:0.4; margin-bottom:10px; text-transform:uppercase; letter-spacing: 1px;" id="cl-label">–Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω</div>
            <div class="changelog-list" id="changelog-container"></div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        function createSnow() {
            const container = document.getElementById('snow-container');
            const count = 25; 
            for (let i = 0; i < count; i++) {
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                const size = Math.random() * 5 + 3; 
                flake.style.width = size + 'px';
                flake.style.height = size + 'px';
                flake.style.left = Math.random() * 100 + 'vw';
                flake.style.animationDuration = Math.random() * 5 + 10 + 's';
                flake.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(flake);
            }
        }

        const UA_MONTHS = ["–°–Ü–ß–ù–Ø", "–õ–Æ–¢–û–ì–û", "–ë–ï–†–ï–ó–ù–Ø", "–ö–í–Ü–¢–ù–Ø", "–¢–†–ê–í–ù–Ø", "–ß–ï–†–í–ù–Ø", "–õ–ò–ü–ù–Ø", "–°–ï–†–ü–ù–Ø", "–í–ï–†–ï–°–ù–Ø", "–ñ–û–í–¢–ù–Ø", "–õ–ò–°–¢–û–ü–ê–î–ê", "–ì–†–£–î–ù–Ø"];
        const RU_MONTHS = ["–Ø–ù–í–ê–†–Ø", "–§–ï–í–†–ê–õ–Ø", "–ú–ê–†–¢–ê", "–ê–ü–†–ï–õ–Ø", "–ú–ê–Ø", "–ò–Æ–ù–Ø", "–ò–Æ–õ–Ø", "–ê–í–ì–£–°–¢–ê", "–°–ï–ù–¢–Ø–ë–†–Ø", "–û–ö–¢–Ø–ë–†–Ø", "–ù–û–Ø–ë–†–Ø", "–î–ï–ö–ê–ë–†–Ø"];
        
        let DATA = [];
        let generatedAt = "";
        let todaySchedule = null;
        let viewSchedule = null;
        
        let selectedQueue = localStorage.getItem('queue');
        let lang = localStorage.getItem('lang') || 'uk';
        let lastStatusType = null; 

        const T = {
            uk: { 
                title: "‚ö° –ì–ü–í", city: "–º. –ó–∞–ø–æ—Ä—ñ–∂–∂—è",
                load: "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...", nodata: "–î–∞–Ω–∏—Ö –Ω–µ–º–∞—î", choose: "–û–±–µ—Ä—ñ—Ç—å —á–µ—Ä–≥—É", 
                on: "–°–í–Ü–¢–õ–û –Ñ", off: "–°–í–Ü–¢–õ–ê –ù–ï–ú–ê", 
                in_on: "–í–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —á–µ—Ä–µ–∑:", in_off: "–í–∏–º–∫–Ω–µ–Ω–Ω—è —á–µ—Ä–µ–∑:", 
                upd: "–ê–∫—Ç—É–∞–ª—å–Ω–æ –Ω–∞:", h: "–≥–æ–¥", m: "—Ö–≤", 
                lbl_on: "–°–≤—ñ—Ç–ª–æ —î", lbl_off: "–°–≤—ñ—Ç–ª–∞ –Ω–µ–º–∞",
                tom: "–∑–∞–≤—Ç—Ä–∞", at: "–æ",
                modal_title: "–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è", dev: "–†–æ–∑—Ä–æ–±–Ω–∏–∫", cl: "–Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω",
                tip: "–ù–∞—Ç–∏—Å–Ω–∏ —Å—é–¥–∏, —â–æ–± —Å—Ö–æ–≤–∞—Ç–∏ –∞–±–æ –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≥–æ–¥—É üå§Ô∏è", tip_btn: "–ó—Ä–æ–∑—É–º—ñ–ª–æ",
                support: "–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏"
            },
            ru: { 
                title: "‚ö° –ì–ü–û", city: "–≥. –ó–∞–ø–æ—Ä–æ–∂—å–µ",
                load: "–ó–∞–≥—Ä—É–∑–∫–∞...", nodata: "–î–∞–Ω–Ω—ã—Ö –Ω–µ—Ç", choose: "–í—ã–±–µ—Ä–∏—Ç–µ –æ—á–µ—Ä–µ–¥—å", 
                on: "–°–í–ï–¢ –ï–°–¢–¨", off: "–°–í–ï–¢–ê –ù–ï–¢", 
                in_on: "–í–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑:", in_off: "–û—Ç–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑:", 
                upd: "–ê–∫—Ç—É–∞–ª—å–Ω–æ –Ω–∞:", h: "—á", m: "–º–∏–Ω", 
                lbl_on: "–°–≤–µ—Ç –µ—Å—Ç—å", lbl_off: "–°–≤–µ—Ç–∞ –Ω–µ—Ç",
                tom: "–∑–∞–≤—Ç—Ä–∞", at: "–≤",
                modal_title: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", dev: "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫", cl: "–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π",
                tip: "–ù–∞–∂–º–∏ —Å—é–¥–∞, —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–≥–æ–¥—É üå§Ô∏è", tip_btn: "–ü–æ–Ω—è–ª",
                support: "–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å"
            }
        };

        async function init() {
            createSnow();
            setLang(lang);
            checkTooltip(); 
            
            if (typeof initWeather === "function") {
                await initWeather(); 
            }

            document.getElementById('loader').innerText = T[lang].load;

            try {
                // –í–ò–ö–û–†–ò–°–¢–û–í–£–Ñ–ú–û RAW –ü–û–°–ò–õ–ê–ù–ù–Ø
                const res = await fetch('https://raw.githubusercontent.com/bogdanshtatskiy-cpu/zap-light/main/schedule.json?v=' + Date.now());
                if (!res.ok) throw new Error("Failed to fetch");
                
                const json = await res.json();
                DATA = json.schedules;
                generatedAt = json.generated_at || "";

                if (!DATA || DATA.length === 0) {
                    document.getElementById('loader').innerText = T[lang].nodata;
                    return;
                }

                document.getElementById('loader').style.display = 'none';
                renderQueues();
                
                const kievDate = new Date(new Date().toLocaleString("en-US", {timeZone: "Europe/Kiev"}));
                const todayDay = kievDate.getDate();
                const todayMonthIdx = kievDate.getMonth();

                let todayIdx = -1;
                DATA.forEach((item, idx) => {
                    const parts = item.date.split(' ');
                    const d = parseInt(parts[0]);
                    const mName = parts[1].toUpperCase();
                    const mIdx = UA_MONTHS.indexOf(mName);
                    if (d === todayDay && mIdx === todayMonthIdx) todayIdx = idx;
                });

                const fallbackIdx = DATA.length - 1;
                const activeIdx = todayIdx !== -1 ? todayIdx : fallbackIdx;

                todaySchedule = DATA[activeIdx]; 
                
                renderDates(activeIdx);
                selectDate(activeIdx);

                if (selectedQueue) selectQueue(selectedQueue);
                else {
                    document.getElementById('hero').style.display = 'block';
                    document.getElementById('status').innerText = T[lang].choose;
                }

                setInterval(tick, 1000);
                tick();

            } catch (e) {
                console.error(e);
                document.getElementById('loader').innerText = "Error loading data (Github Raw)";
            }
        }

        // --- –õ–û–ì–Ü–ö–ê –¢–£–õ–¢–Ü–ü–ê ---
        function checkTooltip() {
            if (!localStorage.getItem('weatherTooltipSeen')) {
                const tooltip = document.getElementById('weather-tooltip');
                tooltip.classList.add('show');
                setTimeout(() => {
                    if (!localStorage.getItem('weatherTooltipSeen')) hideTooltip();
                }, 5000); 
            }
        }

        function hideTooltip() {
            const tooltip = document.getElementById('weather-tooltip');
            tooltip.classList.remove('show');
            localStorage.setItem('weatherTooltipSeen', 'true');
        }

        // --- –ù–û–í–ê –§–£–ù–ö–¶–Ü–Ø –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø –î–ê–¢ (12.01) ---
        function renderDates(activeIdx) {
            const container = document.getElementById('dates');
            container.innerHTML = '';
            
            DATA.forEach((item, idx) => {
                const btn = document.createElement('div');
                btn.className = `date-tab ${idx === activeIdx ? 'active' : ''}`;
                
                let label = item.date;
                const parts = item.date.split(' ');
                
                if (parts.length === 2) {
                    const day = parts[0].padStart(2, '0');
                    const monthName = parts[1].toUpperCase();
                    const monthIdx = UA_MONTHS.indexOf(monthName);
                    
                    if (monthIdx !== -1) {
                        const monthNum = (monthIdx + 1).toString().padStart(2, '0');
                        label = `${day}.${monthNum}`;
                    }
                }

                btn.innerText = label;
                btn.onclick = () => requestAnimationFrame(() => { selectDate(idx); renderDates(idx); });
                container.appendChild(btn);
            });
        }

        function renderQueues() {
            const el = document.getElementById('queues');
            const qs = ["1.1", "1.2", "2.1", "2.2", "3.1", "3.2", "4.1", "4.2", "5.1", "5.2", "6.1", "6.2"];
            el.innerHTML = '';
            qs.forEach(q => {
                const btn = document.createElement('div');
                btn.className = `queue-btn ${q === selectedQueue ? 'active' : ''}`;
                btn.innerText = q;
                btn.onclick = () => selectQueue(q);
                el.appendChild(btn);
            });
        }

        function selectDate(idx) {
            viewSchedule = DATA[idx]; 
            if (typeof renderWeatherForDate === "function") {
                renderWeatherForDate(viewSchedule.date);
            }
            if (selectedQueue) updateView();
        }

        function selectQueue(q) {
            selectedQueue = q;
            localStorage.setItem('queue', q);
            document.querySelectorAll('.queue-btn').forEach(b => {
                if (b.innerText === q) b.classList.add('active');
                else b.classList.remove('active');
            });
            document.getElementById('hero').style.display = 'block';
            document.getElementById('bar-wrap').style.display = 'block';
            document.getElementById('stats').style.display = 'grid';
            document.getElementById('details-list').style.display = 'block';
            
            lastStatusType = null;
            tick();
            updateView();
        }

        function setLang(l) {
            lang = l;
            localStorage.setItem('lang', l);
            
            document.getElementById('btn-uk').className = `lang-btn ${l==='uk'?'active':''}`;
            document.getElementById('btn-ru').className = `lang-btn ${l==='ru'?'active':''}`;
            
            document.getElementById('app-title').innerText = T[l].title;
            document.getElementById('city-label').innerText = T[l].city;
            document.getElementById('lbl-on').innerText = T[l].lbl_on;
            document.getElementById('lbl-off').innerText = T[l].lbl_off;
            document.getElementById('modal-title').innerText = T[l].modal_title;
            document.getElementById('dev-label').innerText = T[l].dev;
            document.getElementById('cl-label').innerText = T[l].cl;
            
            const donateText = document.getElementById('donate-text');
            if (donateText && T[l].support) {
                donateText.innerText = T[l].support;
            }

            const tooltip = document.getElementById('weather-tooltip');
            if (tooltip) {
                tooltip.innerHTML = `${T[l].tip} <button class="tooltip-btn" onclick="hideTooltip()">${T[l].tip_btn}</button>`;
            }
            
            if (typeof updateWeatherLang === "function") {
                if (viewSchedule) renderWeatherForDate(viewSchedule.date);
            }

            if(DATA.length) {
                const idx = DATA.indexOf(viewSchedule);
                renderDates(idx !== -1 ? idx : 0);
                if (!selectedQueue) document.getElementById('status').innerText = T[l].choose;
                else {
                    updateView();
                    tick();
                }
            }
            renderChangelog();
        }

        function updateView() {
            if (!viewSchedule || !selectedQueue) return;

            const listEl = document.getElementById('details-list');
            const listFrag = document.createDocumentFragment();
            const timeline = document.getElementById('visual');
            const barFrag = document.createDocumentFragment();
            const map = getDayMap(viewSchedule, selectedQueue);
            
            let current = map[0];
            let start = 0;

            for(let i=1; i<=1440; i++) {
                if(i===1440 || map[i] !== current) {
                    const d = document.createElement('div');
                    d.className = `chunk ${current ? 'on' : 'off'}`;
                    d.style.flexBasis = ((i-start)/1440*100) + '%';
                    barFrag.appendChild(d);

                    const row = document.createElement('div');
                    row.className = 'list-row';
                    const timeRange = `${minsToTime(start)} - ${minsToTime(i)}`;
                    const badgeClass = current ? 'badge-on' : 'badge-off';
                    const text = current ? T[lang].on : T[lang].off;
                    const icon = current ? 'üí°' : 'üïØÔ∏è';
                    
                    row.innerHTML = `
                        <div class="row-time">${timeRange}</div>
                        <div class="row-badge ${badgeClass}">${icon} ${text}</div>
                    `;
                    listFrag.appendChild(row);

                    current = map[i];
                    start = i;
                }
            }

            timeline.innerHTML = '';
            timeline.appendChild(barFrag);
            listEl.innerHTML = '';
            listEl.appendChild(listFrag);

            let offCount = 0;
            for(let i=0; i<1440; i++) { if(map[i] === false) offCount++; }
            document.getElementById('val-off').innerText = fmtDur(offCount);
            document.getElementById('val-on').innerText = fmtDur(1440 - offCount);
        }

        function updateQuote(type) {
            if (typeof QUOTES_DB === 'undefined') return;
            if (lastStatusType !== type) {
                lastStatusType = type;
                const list = QUOTES_DB[lang][type];
                if (list && list.length > 0) {
                    const rnd = Math.floor(Math.random() * list.length);
                    const qEl = document.getElementById('quote');
                    qEl.style.opacity = 0;
                    setTimeout(() => {
                        qEl.innerText = list[rnd];
                        qEl.style.opacity = 0.9;
                    }, 200);
                }
            }
        }

        function tick() {
            if (!todaySchedule || !selectedQueue) return;

            const updateTimeStr = generatedAt || todaySchedule.updated_at;
            const updText = `${T[lang].upd} ${updateTimeStr}`;
            const updEl = document.getElementById('updated');
            if (updEl.innerText !== updText) updEl.innerText = updText;

            const now = new Date(new Date().toLocaleString("en-US", {timeZone: "Europe/Kiev"}));
            const curMins = now.getHours() * 60 + now.getMinutes();
            const curSecs = curMins * 60 + now.getSeconds();

            const viewParts = viewSchedule.date.split(' ');
            const vD = parseInt(viewParts[0]);
            const vMIdx = UA_MONTHS.indexOf(viewParts[1].toUpperCase());
            const isViewingToday = (vD === now.getDate() && vMIdx === now.getMonth());

            const marker = document.getElementById('marker');
            marker.style.display = isViewingToday ? 'block' : 'none';
            if(isViewingToday) marker.style.left = (curMins / 1440 * 100) + '%';

            const map = getDayMap(todaySchedule, selectedQueue);
            const isLight = map[curMins] !== undefined ? map[curMins] : true;
            
            let nextChange = -1;
            for(let i = curMins + 1; i < 1440; i++) {
                if(map[i] !== isLight) { nextChange = i; break; }
            }

            let totalSecsLeft = 0;
            let timeInfoStr = "";
            
            if (nextChange !== -1) {
                totalSecsLeft = (nextChange * 60) - curSecs;
                const eventTimeLabel = minsToTime(nextChange);
            } else {
                const secsToMidnight = (1440 * 60) - curSecs;
                const currentIdx = DATA.indexOf(todaySchedule);
                const nextDaySchedule = DATA[currentIdx + 1];
                let foundChangeTomorrow = false;
                let nextChangeTom = -1;

                if (nextDaySchedule) {
                    const nextMap = getDayMap(nextDaySchedule, selectedQueue);
                    if (nextMap[0] === isLight) {
                        for(let i = 0; i < 1440; i++) {
                            if(nextMap[i] !== isLight) { nextChangeTom = i; break; }
                        }
                        if (nextChangeTom !== -1) {
                            totalSecsLeft = secsToMidnight + (nextChangeTom * 60);
                            const eventTimeLabel = minsToTime(nextChangeTom);
                            timeInfoStr = `<span class="timer-note">(${T[lang].tom} ${T[lang].at} ${eventTimeLabel})</span>`;
                            foundChangeTomorrow = true;
                        }
                    } else {
                        totalSecsLeft = secsToMidnight;
                        timeInfoStr = `<span class="timer-note">(${T[lang].tom} ${T[lang].at} 00:00)</span>`;
                        foundChangeTomorrow = true;
                    }
                } 
                if (!foundChangeTomorrow) totalSecsLeft = secsToMidnight;
            }

            const h = Math.floor(totalSecsLeft / 3600);
            const m = Math.floor((totalSecsLeft % 3600) / 60);
            const s = Math.floor(totalSecsLeft % 60);
            const timeStr = `${pad(h)}:${pad(m)}:${pad(s)}`;

            const body = document.body;
            
            // --- –õ–û–ì–Ü–ö–ê –ü–ï–†–°–û–ù–ê–ñ–ê ---
            const powerSpirit = document.getElementById('power-spirit');
            const st = document.getElementById('status');
            const tm = document.getElementById('timer');

            if (isLight) {
                body.classList.remove('dark-mode');
                
                // –í–º–∏–∫–∞—î–º–æ —Ä–µ–∂–∏–º BOSS
                powerSpirit.classList.add('mode-on');
                powerSpirit.classList.remove('mode-off');
                
                if (st.innerText !== T[lang].on) st.innerText = T[lang].on;
                st.style.color = 'var(--text)';
                const newHtml = `${T[lang].in_off} ${timeStr} ${timeInfoStr}`;
                if (tm.innerHTML !== newHtml) tm.innerHTML = newHtml;
                updateQuote('on');
            } else {
                body.classList.add('dark-mode');
                
                // –í–º–∏–∫–∞—î–º–æ —Ä–µ–∂–∏–º MEDIEVAL
                powerSpirit.classList.add('mode-off');
                powerSpirit.classList.remove('mode-on');
                
                if (st.innerText !== T[lang].off) st.innerText = T[lang].off;
                st.style.color = 'var(--off)';
                const newHtml = `${T[lang].in_on} ${timeStr} ${timeInfoStr}`;
                if (tm.innerHTML !== newHtml) tm.innerHTML = newHtml;
                updateQuote('off');
            }
        }

        function getDayMap(schedule, queue) {
            const map = new Array(1440).fill(true);
            const list = schedule.queues[queue] || [];
            list.forEach(o => {
                let s = timeToMins(o.start), e = timeToMins(o.end);
                if(e===0) e=1440;
                for(let i=s; i<e; i++) if(i<1440) map[i] = false;
            });
            return map;
        }

        function openInfo() {
            renderChangelog();
            const modal = document.getElementById('info-modal');
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('show'), 10);
        }

        function closeInfo() {
            const modal = document.getElementById('info-modal');
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = 'none', 300);
        }

        function renderChangelog() {
            if (typeof CHANGELOG_DATA === 'undefined') return;
            const container = document.getElementById('changelog-container');
            container.innerHTML = '';
            CHANGELOG_DATA.forEach(ver => {
                const item = document.createElement('div');
                item.className = 'cl-item';
                const changesList = ver.changes[lang] || ver.changes['uk'];
                const listHtml = changesList.map(c => `<li>${c}</li>`).join('');
                item.innerHTML = `
                    <div class="cl-ver">v${ver.version}</div>
                    <span class="cl-date">${ver.date}</span>
                    <div class="cl-desc"><ul>${listHtml}</ul></div>
                `;
                container.appendChild(item);
            });
        }

        function timeToMins(s) { const p=s.split(':'); return parseInt(p[0])*60 + parseInt(p[1]); }
        function minsToTime(m) { 
            if(m===1440) return "24:00";
            return `${Math.floor(m/60).toString().padStart(2,'0')}:${(m%60).toString().padStart(2,'0')}`;
        }
        function fmtDur(m) {
            const h = Math.floor(m/60), mn = m%60;
            if(h>0 && mn>0) return `${h}${T[lang].h} ${mn}${T[lang].m}`;
            if(h>0) return `${h} ${T[lang].h}`;
            return `${mn} ${T[lang].m}`;
        }
        function pad(n) { return n.toString().padStart(2,'0'); }

        init();
    </script>
</body>
</html>
